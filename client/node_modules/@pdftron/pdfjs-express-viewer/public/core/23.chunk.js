/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[23],{355:function(Ea,va,y){y.r(va);var pa=y(2),ka=y(14),ja=y(1);Ea=y(46);var fa=y(30),da=y(9);y=function(){function z(){this.init()}z.prototype.init=function(){this.gX=!1;this.se=this.$i=this.connection=null;this.Jo={};this.za=this.bA=null};z.prototype.h$=function(r){for(var w=this,n=0;n<r.length;++n){var a=r[n];switch(a.at){case "create":this.Jo[a.author]||(this.Jo[a.author]=a.aName);this.i2(a);break;case "modify":this.za.xp(a.xfdf).then(function(b){w.za.eP(b[0])});
break;case "delete":this.za.xp("<delete><id>"+a.aId+"</id></delete>")}}};z.prototype.i2=function(r){var w=this;this.za.xp(r.xfdf).then(function(n){n=n[0];n.authorId=r.author;w.za.eP(n);w.za.trigger(ka.a.UPDATE_ANNOTATION_PERMISSION,[n])})};z.prototype.J1=function(r,w,n){this.$i&&this.$i(r,w,n)};z.prototype.preloadAnnotations=function(r){this.addEventListener("webViewerServerAnnotationsEnabled",this.J1.bind(this,r,"add",{imported:!1}),{once:!0})};z.prototype.initiateCollaboration=function(r,w,n){var a=
this;if(r){a.se=w;a.za=n.Ca();n.addEventListener(ka.c.DOCUMENT_UNLOADED,function(){a.disableCollaboration()});a.D$(r);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var e=JSON.parse(b.responseText);a.connection=exports.Ya.haa(Object(fa.h)(a.se,"blackbox/"),"annot");a.bA=e.id;a.Jo[e.id]=e.user_name;a.za.bQ(e.id);a.connection.qG(function(f){f.t&&f.t.startsWith("a_")&&f.data&&a.h$(f.data)},function(){a.connection.send({t:"a_retrieve",dId:r});
a.trigger(z.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[a.Jo[e.id],a.bA])},function(){a.disableCollaboration()})}catch(f){Object(ja.f)(f.message)}});b.open("GET",Object(fa.h)(this.se,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();a.gX=!0;a.za.Q7(function(e){return a.Jo[e.Author]||e.Author})}else Object(ja.f)("Document ID required for collaboration")};z.prototype.disableCollaboration=function(){this.$i&&(this.za.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.$i),this.$i=null);this.connection&&
this.connection.DC();this.za&&this.za.bQ("Guest");this.init();this.trigger(z.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};z.prototype.D$=function(r){var w=this;this.$i&&this.za.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.$i);this.$i=function(n,a,b){return Object(pa.b)(this,void 0,void 0,function(){var e,f,h,x,aa,ca,ia,ea,ha;return Object(pa.d)(this,function(ba){switch(ba.label){case 0:if(b.imported)return[2];e={t:"a_"+a,dId:r,annots:[]};return[4,w.za.XZ()];case 1:f=ba.ea();"delete"!==
a&&(h=(new DOMParser).parseFromString(f,"text/xml"),x=new XMLSerializer);for(aa=0;aa<n.length;aa++)ca=n[aa],ea=ia=void 0,"add"===a?(ia=h.querySelector('[name="'+ca.Id+'"]'),ea=x.serializeToString(ia),ha=null,ca.InReplyTo&&(ha=w.za.VC(ca.InReplyTo).authorId||"default"),e.annots.push({at:"create",aId:ca.Id,author:w.bA,aName:w.Jo[w.bA],parent:ha,xfdf:"<add>"+ea+"</add>"})):"modify"===a?(ia=h.querySelector('[name="'+ca.Id+'"]'),ea=x.serializeToString(ia),e.annots.push({at:"modify",aId:ca.Id,xfdf:"<modify>"+
ea+"</modify>"})):"delete"===a&&e.annots.push({at:"delete",aId:ca.Id});0<e.annots.length&&w.connection.send(e);return[2]}})})}.bind(w);this.za.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.$i)};z.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return z}();Object(Ea.a)(y);va["default"]=y}}]);}).call(this || window)
